#!/bin/bash

source /home/bitergia/conf/requirements.cfg

# get SortingHat repository
cd /home/bitergia && \
git clone https://github.com/MetricsGrimoire/sortinghat.git && \
    cd sortinghat && \
    git checkout $SORTINGHAT && \
    sudo python3 setup.py install

# get GrimoireELK repository
cd /home/bitergia && \
git clone https://github.com/grimoirelab/GrimoireELK && \
    cd GrimoireELK && \
    git checkout $GRIMOIREELK

# get Mordred repository
cd /home/bitergia && \
git clone https://github.com/Bitergia/mordred.git mordred && \
    cd mordred && \
    git checkout $MORDRED

# panels for the dashboard
cd /home/bitergia && \
git clone https://github.com/grimoirelab/panels.git panels && \
    cd panels && \
    git checkout $PANELS

# get VizGrimoireUtils repository for tools like eclipse_projects
cd /home/bitergia && \
git clone https://github.com/VizGrimoire/VizGrimoireUtils.git && \
    cd VizGrimoireUtils && \
    git checkout $VIZGRIMOIREUTILS

# get Perceval repository
cd /home/bitergia && \
git clone https://github.com/grimoirelab/perceval.git && \
    cd perceval && \
    git checkout $PERCEVAL && \
    sudo python3 setup.py install


# some links we need until GrimoireELK and panels can be installed
ln -s /home/bitergia/GrimoireELK/grimoire /home/bitergia/mordred/grimoire
ln -s /home/bitergia/panels /home/bitergia/mordred/panels

cd /home/bitergia/mordred && \
python3 mordred.py -c /home/bitergia/conf/setup.cfg

sleep 86400
